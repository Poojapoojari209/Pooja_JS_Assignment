{% extends "base.html" %}

{% block content %}
<h2 class="text-center mb-4">Products</h2>

<div class="row" id="productList"></div>

<script>
async function loadProducts() {
    let res = await fetch("/api/products");
    let products = await res.json();

    let container = document.getElementById("productList");
    container.innerHTML = "";

    products.forEach(p => {
        container.innerHTML += `
            <div class="col-md-4 mb-3">
                <div class="card shadow p-3">
                    <h5>${p.name}</h5>
                    <p>â‚¹ ${p.price}</p>
                    <p>${p.description || ""}</p>

                    <button class="btn btn-primary"
                        onclick="addToCart(${p.id})">
                        Add to Cart
                    </button>

                </div>
            </div>
        `;
    });
}

async function addToCart(productId) {
    // let token = localStorage.getItem("token");

    // if (!token) {
    //     alert("Please login first");
    //     window.location.href = "/login";
    //     return;
    // }

    let res = await fetch("/cart/add", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
            product_id: productId
        })
    });

    let data = await res.json();
    alert(data.msg);
}

loadProducts();
</script>



{% endblock %}
